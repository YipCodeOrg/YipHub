<!DOCTYPE html>
<html>
    <head>
        <script type="text/javascript" src="../env.js"></script>            
        <script type="text/javascript">
            'use strict';

            //TODO: Add some frame-breaking code to ensure this is only embedded in yipFrontOrigin page

            document.addEventListener("DOMContentLoaded", init);
            window.addEventListener("message", handleFrontMessage);
            
            const yipFrontOrigin = env.yipFrontOrigin

            function init(){
                postLoginStatus()
            }

            function postLoginStatus(){
                console.log("Posting login status from Hub...")
                const isLoggedIn = !!localStorage.getItem("access_token")
                const status = isLoggedIn ? "userIsLoggedIn" : "userNotLoggedIn"
                postFrontMessage(status)
                console.log("...Hub finished posting login status")
            }

            function handleFrontMessage(msgEvent) {
                if(msgEvent.origin != yipFrontOrigin){
                    throw "Origin mismatch. Will not process message."
                }
                console.log(msgEvent);
            }

            function postFrontMessage(msg){
                window.top.postMessage(msg, yipFrontOrigin)
            }

        </script>            
    </head>
</html>